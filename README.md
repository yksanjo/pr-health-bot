# ğŸ§ª PR Health Bot

> A GitHub Action that automatically comments on Pull Requests with a PR Health Check summary

[![GitHub](https://img.shields.io/badge/GitHub-yksanjo%2Fpr--health--bot-blue)](https://github.com/yksanjo/pr-health-bot)
[![GitHub Actions](https://img.shields.io/badge/GitHub-Actions-blue.svg)](https://github.com/features/actions)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.3-blue.svg)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-20-green.svg)](https://nodejs.org/)

## âœ¨ Features

- **PR Size Check** - Automatically categorizes PRs as Small (â‰¤200 lines), Medium (201-400 lines), or Large (>400 lines)
- **Description Check** - Warns if PR description is missing
- **Tests Check** - Detects if test files were added/modified
- **Idempotent Comments** - Updates existing comments instead of creating duplicates
- **Zero Configuration** - Works out of the box with sensible defaults

## ğŸš€ Quick Start

### Option 1: Use as a Reusable Action (Recommended)

1. Create `.github/workflows/pr-health.yml` in your repository:

```yaml
name: PR Health Check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-health:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build action
        run: npm run build
      
      - name: Run PR Health Bot
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
```

2. That's it! The bot will automatically comment on every PR.

### Option 2: Use from GitHub Repository

You can use it directly from the repository:

```yaml
- name: Run PR Health Bot
  uses: yksanjo/pr-health-bot@main
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

> **Note**: Replace `@main` with a specific version tag (e.g., `@v1.0.0`) for production use.

## ğŸ“Š Example Output

The bot will post a comment like this on every PR:

```
ğŸ§ª **PR Health Report**

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

**PR Size:** 482 lines â€” ğŸ”´ Large
*Large PRs slow down review and increase bugs.*

**Description:** âŒ None Provided
*Please add context so reviewers understand the purpose.*

**Tests Added:** âš ï¸ No tests found
*Consider adding test coverage for new logic.*

---

Generated by **PR Health Bot**
```

## ğŸ¯ Health Check Criteria

### PR Size Categories

- ğŸŸ¢ **Small**: â‰¤ 200 lines (additions + deletions)
- ğŸŸ¡ **Medium**: 201-400 lines
- ğŸ”´ **Large**: > 400 lines (includes warning message)

### Description Check

- âœ… **Pass**: PR body/description exists and is not empty
- âŒ **Fail**: PR body is missing or empty

### Tests Check

The bot looks for files that:
- Contain "test" in the filename (case-insensitive)
- End with `.test.js`, `.test.ts`, `.test.jsx`, `.test.tsx`
- End with `.spec.js`, `.spec.ts`, `.spec.jsx`, `.spec.tsx`

## ğŸ› ï¸ Development

### Prerequisites

- Node.js 20+
- npm

### Setup

```bash
# Install dependencies
npm install

# Build the action
npm run build

# Package for distribution (creates dist/ folder)
npm run package
```

### Project Structure

```
pr-health-bot/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ pr-health.yml      # Example workflow
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts               # Main action code
â”œâ”€â”€ dist/                      # Compiled output (generated)
â”œâ”€â”€ action.yml                 # Action metadata
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ“ How It Works

1. **Triggers**: Runs on `pull_request` events (opened, synchronize, reopened)
2. **Analysis**: 
   - Fetches PR files using GitHub API
   - Calculates total lines changed (additions + deletions)
   - Checks PR description
   - Scans filenames for test patterns
3. **Commenting**: 
   - Searches for existing bot comment
   - Updates if found, creates new if not
   - Ensures only one comment per PR

## ğŸ”’ Permissions

The action requires the following permissions:

- `issues: write` - To create/update comments
- `pull-requests: read` - To read PR data and files

These are automatically granted when using `GITHUB_TOKEN` in workflows.

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“„ License

MIT License - see LICENSE file for details

## ğŸ—ºï¸ Roadmap (Phase 2)

Future enhancements planned:

- [ ] Config file (`.pr-health.yml`) for custom thresholds
- [ ] Number of reviewers check
- [ ] Detect "WIP", "fix typo", etc. in title
- [ ] Coverage badge integration
- [ ] Automated labels (e.g., "size: large")
- [ ] Team-level analytics

## ğŸ™ Acknowledgments

Built with:
- [@actions/core](https://github.com/actions/toolkit/tree/main/packages/core)
- [@actions/github](https://github.com/actions/toolkit/tree/main/packages/github)

---

**Made with â¤ï¸ for better code reviews**

